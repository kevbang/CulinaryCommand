@using CulinaryCommand.Inventory.Entities
@using CulinaryCommand.Inventory.Services
@inject IngredientService Ingredients
@inject UnitService Units
@inject NavigationManager Nav;
@inject EnumService enumService
@rendermode InteractiveServer


<div class="card shadow-sm">
    <div class="card-header">
        <h4>@FormTitle</h4>
    </div>

    <div class="card-body">
        <div class="mb-3">
            <label class="form-label">Name</label>
            <input class="form-control" @bind="Model.Name" />
        </div>

        <div class="mb-3">
            <label class="form-label">Category</label>
            <select class="form-select" @bind="Model.Category">
                <option value="">-- Select Category --</option>
                @foreach (var c in Categories)
                {
                    <option value="@c">@c</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Default Unit</label>
            <select class="form-select" @bind="Model.UnitId">
                <option value="0">-- Select Unit --</option>
                @foreach (var u in UnitsList)
                {
                    <option value="@u.Id">@u.Name (@u.Abbreviation)</option>
                }
            </select>
        </div>

        <button class="btn btn-success" @onclick="Save">Save</button>
        <button class="btn btn-outline-secondary ms-2" @onclick="Cancel">Cancel</button>
    </div>
</div>

@code {
    [Parameter] public Ingredient Model { get; set; } = new();
    [Parameter] public string FormTitle { get; set; } = "Ingredient";
    [Parameter] public EventCallback OnValidSubmit { get; set; }

    List<Unit> UnitsList = new();
    List<string> Categories = new();

    protected override async Task OnInitializedAsync()
    {
        UnitsList = await Units.GetAllUnitsAsync();
        Categories = enumService.GetCategories();
    }

    async Task Save() => await OnValidSubmit.InvokeAsync();
    void Cancel() => Nav.NavigateTo("/ingredients");
}
