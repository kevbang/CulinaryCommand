@rendermode InteractiveServer
@using CulinaryCommand.Data.Entities
@using CulinaryCommand.Services.UserContextSpace

@inject IUserContextService UserCtx

<div class="card shadow-sm p-3">

    <h4>@(CompanyDisplay ?? "Company")</h4>

    @if (Location == null)
    {
        <div class="alert alert-warning">No assigned location.</div>
    }
    else
    {
        <h5>@Location.Name</h5>
        <p class="mb-1">@Location.Address</p>
        <p class="mb-1">@Location.City, @Location.State @Location.ZipCode</p>
    }

</div>

@code {
    [Parameter] public Location? Location { get; set; }

    private string? CompanyDisplay;

    protected override async Task OnInitializedAsync()
    {
        var ctx = await UserCtx.GetAsync();

        // Invite-only: ctx.User null means authenticated but not in DB
        CompanyDisplay =
            ctx.User?.Company?.Name
            ?? ctx.User?.Company?.CompanyCode
            ?? "Company";
    }
}
