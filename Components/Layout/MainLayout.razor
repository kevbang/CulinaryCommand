@inherits LayoutComponentBase
@using CulinaryCommand.Models
@using CulinaryCommand.Services
@inject CulinaryCommand.Services.AuthService Auth
@inject NavigationManager Nav
@using System.Threading.Tasks
@rendermode InteractiveServer


<div class="page">
  <div class="sidebar"><NavMenu /></div>

  <main>
    <div class="top-row px-4 d-flex justify-content-end align-items-center">
        <LocationSelector />
        <ProfileDropdown />
    </div>

    <article class="content px-4">
      @Body
    </article>
  </main>
</div>

@code {
  private bool _hydrated;

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
      if (!firstRender || _hydrated)
          return;

      var path = Nav.Uri.ToLowerInvariant();
      if (!path.Contains("/signin") && !path.Contains("/signup") && !path.Contains("/adminsignup"))
      {
          await Auth.EnsureHydratedAsync();
      }

      _hydrated = true;
      StateHasChanged();
  }
}
