@page "/tasks"
@using CulinaryCommand.Components.Custom

<PageTitle>My Tasks</PageTitle>

<div class="container mt-4">
    <h1 class="fw-bold mb-3">Current Tasks</h1>
    <h5>Good morning, @username ðŸ‘‹</h5>
    <h5>Here's what's on your prep list today</h5>

    @if (taskList == null || taskList.Count == 0)
    {
        <p><em>No tasks available.</em></p>
    }
    else
    {
        <div class="row g-3">
            @foreach (var t in taskList) // task list defined below
{
    <div class="col-12 col-sm-6 col-lg-4">
        <TaskCard TaskName="@t.TaskName" Station="@t.Station" Time="@t.Time" Status="@t.Status"
            OnComplete="() => MarkTaskComplete(t)" OnDelete="() => RemoveTask(t)" />
    </div>
}
        </div>
    }
</div>

@code {
    private class TaskData
    {
        public string TaskName { get; set; } = "";
        public string Station { get; set; } = "";
        public string Time { get; set; } = "";
        public string Status { get; set; } = "Pending";
    }

    private List<TaskData> taskList = new();
    private string username = "Dan";

    // tasks are currently hardcoded to this component
    // in the future, this will be an API call
    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(500);
        taskList = new()
{
new() { TaskName = "Cook chicken", Station = "Grill", Time = "10am" },
new() { TaskName = "Cut peppers", Station = "Prep", Time = "2pm" },
new() { TaskName = "Clean dishes", Station = "Dish", Time = "10pm" }
};
    }

    private void MarkTaskComplete(TaskData task)
    {
        Console.WriteLine($"[DEBUG] MarkTaskComplete called for {task.TaskName}");
        task.Status = "Completed";
        StateHasChanged(); //re-render UI
    }
    private void RemoveTask(TaskData task)
    {
        taskList.Remove(task);
        StateHasChanged();
    }
}